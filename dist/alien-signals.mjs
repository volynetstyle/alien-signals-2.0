var R=(a=>(a[a.None=0]="None",a[a.Mutable=1]="Mutable",a[a.Watching=2]="Watching",a[a.RecursedCheck=3]="RecursedCheck",a[a.Recursed=4]="Recursed",a[a.Dirty=5]="Dirty",a[a.Pending=6]="Pending",a))(R||{});function V({update:e,notify:n,unwatched:d}){return{link:h,unlink:m,propagate:v,checkDirty:j,shallowPropagate:a,isValidLink:k};function h(i,t,s){let f=t.depsTail;if(f!==void 0&&f.dep===i)return;let u=i.subsTail;if(u!==void 0&&u.version===s&&u.sub===t)return;let r=t.deps,o;if(f!==void 0){if(o=f.nextDep,o!==void 0&&o.dep===i){o.version=s,o.depEpoch=t.depsEpoch,t.depsTail=o;return}}else if(o=r,o!==void 0&&o.dep===i){o.version=s,o.depEpoch=t.depsEpoch,t.depsTail=o;return}let c={dep:i,sub:t,prevDep:f,nextDep:void 0,prevSub:u,nextSub:void 0,version:s,depEpoch:t.depsEpoch};f!==void 0?f.nextDep=c:t.deps=c,t.depsTail=c,u!==void 0?u.nextSub=c:i.subs=c,i.subsTail=c}function m(i,t=i.sub){let s=i.dep,f=i.nextDep,u=i.prevDep,r=i.nextSub,o=i.prevSub;if(u!==void 0?u.nextDep=f:t.deps=f,f!==void 0?f.prevDep=u:t.depsTail=u,o!==void 0)o.nextSub=r;else if(s.subs=r,r===void 0)return s.subsTail=void 0,d(s),f;return r!==void 0?r.prevSub=o:s.subsTail=o,f}function v(i){let t=i.nextSub,s;e:do{let f=i.sub,u=f.flags;if(u&7?u&7?u&3?!(u&7)&&k(i,f)?(f.flags=u|6,u&=1):u=0:f.flags=u&-5|6:u=0:f.flags=u|6,u&2&&n(f),u&1){let r=f.subs;if(r!==void 0){let o=(i=r).nextSub;o!==void 0&&(s={value:t,prev:s},t=o);continue}}if((i=t)!==void 0){t=i.nextSub;continue}for(;s!==void 0;)if(i=s.value,s=s.prev,i!==void 0){t=i.nextSub;continue e}break}while(!0)}function j(i,t){let s,f=0,u=!1;e:do{let r=i.dep,o=r.flags;if(t.flags&5)u=!0;else if((o&5)===5){if(e(r)){let c=r.subs;c.nextSub!==void 0&&a(c),u=!0}}else if((o&7)===7){(i.nextSub!==void 0||i.prevSub!==void 0)&&(s={value:i,prev:s}),i=r.deps,t=r,++f;continue}if(!u){let c=i.nextDep;if(c!==void 0){i=c;continue}}for(;f--;){let c=t.subs,M=c.nextSub!==void 0;if(M?(i=s.value,s=s.prev):i=c,u){if(e(t)){M&&a(c),t=i.sub;continue}u=!1}else t.flags&=-7;t=i.sub;let P=i.nextDep;if(P!==void 0){i=P;continue e}}return u}while(!0)}function a(i){do{let t=i.sub,s=t.flags;(s&7)===6&&(t.flags=s|5,(s&3)===2&&n(t))}while((i=i.nextSub)!==void 0)}function k(i,t){return i.sub===t&&i.depEpoch===t.depsEpoch}}var S=0,x=0,b=0,T=0,l,p=[],{link:N,unlink:E,propagate:L,checkDirty:W,shallowPropagate:C}=V({update(e){return e.depsTail!==void 0?I(e):O(e)},notify(e){let n=T,d=n;do if(p[n++]=e,e.flags&=-3,e=e.subs?.sub,e===void 0||!(e.flags&2))break;while(!0);for(T=n;d<--n;){let h=p[d];p[d++]=p[n],p[n]=h}},unwatched(e){e.flags&1?e.depsTail!==void 0&&(e.depsTail=void 0,e.flags=5,D(e)):y.call(e)}});function U(){return l}function g(e){let n=l;return l=e,n}function X(){return x}function Y(){++x}function Z(){--x||w()}function _(e){return e.name==="bound "+q.name}function $(e){return e.name==="bound "+B.name}function F(e){return e.name==="bound "+A.name}function ee(e){return e.name==="bound "+y.name}function ne(e){return q.bind({currentValue:e,pendingValue:e,deps:void 0,depsTail:void 0,subs:void 0,subsTail:void 0,flags:1,depsEpoch:0})}function ie(e){return B.bind({value:void 0,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:0,depsEpoch:0,getter:e})}function te(e){let n={fn:e,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:3,depsEpoch:0},d=g(n);d!==void 0&&N(n,d,0);try{n.fn()}finally{l=d,n.flags&=-4}return A.bind(n)}function de(e){let n={deps:void 0,depsTail:void 0,subs:void 0,subsTail:void 0,flags:0,depsEpoch:0},d=g(n);d!==void 0&&N(n,d,0);try{e()}finally{l=d}return y.bind(n)}function ue(e){let n={deps:void 0,depsTail:void 0,subs:void 0,subsTail:void 0,flags:2,depsEpoch:0},d=g(n);try{e()}finally{l=d;let h=n.deps;for(;h!==void 0;){let m=h.dep;h=E(h,n);let v=m.subs;v!==void 0&&(n.flags=0,L(v),C(v))}x||w()}}function I(e){++S,++e.depsEpoch,e.depsTail=void 0,e.flags=3;let n=g(e);try{let d=e.value;return d!==(e.value=e.getter(d))}finally{l=n,e.flags&=-4,D(e)}}function O(e){return e.flags=1,e.currentValue!==(e.currentValue=e.pendingValue)}function z(e){let n=e.flags;if(n&5||n&6&&W(e.deps,e)){++S,++e.depsEpoch,e.depsTail=void 0,e.flags=3;let d=g(e);try{e.fn()}finally{l=d,e.flags&=-4,D(e)}}else e.flags=2}function w(){try{for(;b<T;){let e=p[b];p[b++]=void 0,z(e)}}finally{for(;b<T;){let e=p[b];p[b++]=void 0,e.flags|=6}b=0,T=0}}function B(){let e=this.flags;if(e&5||e&6&&(W(this.deps,this)||(this.flags=e&-7,!1))){if(I(this)){let d=this.subs;d!==void 0&&C(d)}}else if(!e){this.flags=3;let d=g(this);try{this.value=this.getter()}finally{l=d,this.flags&=-4}}let n=l;return n!==void 0&&N(this,n,S),this.value}function q(...e){if(e.length){if(this.pendingValue!==(this.pendingValue=e[0])){this.flags=5;let n=this.subs;n!==void 0&&(L(n),x||w())}}else{if(this.flags&5&&O(this)){let d=this.subs;d!==void 0&&C(d)}let n=l;for(;n!==void 0;){if(n.flags&3){N(this,n,S);break}n=n.subs?.sub}return this.currentValue}}function A(){y.call(this)}function y(){this.depsTail=void 0,this.flags=0,D(this);let e=this.subs;e!==void 0&&E(e)}function D(e){let n=e.depsTail,d=n!==void 0?n.nextDep:e.deps;for(;d!==void 0;)d=E(d,e)}export{R as ReactiveFlags,ie as computed,V as createReactiveSystem,te as effect,de as effectScope,Z as endBatch,U as getActiveSub,X as getBatchDepth,$ as isComputed,F as isEffect,ee as isEffectScope,_ as isSignal,g as setActiveSub,ne as signal,Y as startBatch,ue as trigger};
